steps:
# 1. On installe et on lance la vectorisation
- name: 'python:3.10-slim'
  entrypoint: 'bash'
  args:
  - '-c'
  - |
    apt-get update && apt-get install -y git build-essential
    pip install --upgrade pip
    pip install -r requirements.txt
    echo "üöÄ D√©marrage de la vectorisation sur le Cloud..."
    python build_db.py
    echo "‚úÖ Vectorisation termin√©e !"
  
  # C'EST ICI QUE JE RAJOUTE LA CL√â (Indispensable !) ‚¨áÔ∏è
  env:
  - 'GOOGLE_API_KEY=AIzaSyDHMHW5xlMGGlEWIsLzEgbBwG-Tn3ctxQ8'

# 2. On sauvegarde le cerveau tout neuf dans le Bucket
- name: 'gcr.io/cloud-builders/gcloud'
  args: ['storage', 'cp', '-r', 'chroma_db/chroma.sqlite3', 'gs://social2026-data/chroma.sqlite3']

timeout: 7200s
options:
  machineType: 'E2_HIGHCPU_8'